import{a as D,b as A,u as T}from"./Cm96zG12.js";import{l as z,d as u,I as R,E as n,H as e,M as v,a0 as S,Q as f,U as r,F as V,P,G as a}from"./DQgDrh1u.js";import{_ as F}from"./DlAUqK2U.js";import"./DAvq3nrc.js";const I={class:"min-h-screen bg-gray-50"},$={class:"bg-white shadow-sm border-b border-gray-200"},G={class:"px-8 py-6"},N={class:"flex items-center justify-between"},H={class:"flex items-center space-x-4"},U=["disabled"],W={class:"p-8"},O={class:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8"},Q={class:"card-modern-gradient from-green-500 to-green-600"},q={class:"flex items-center justify-between text-white"},J={class:"text-3xl font-bold"},K={class:"text-green-100 text-sm mt-1"},X={class:"card-modern-gradient from-blue-500 to-blue-600"},Y={class:"flex items-center justify-between text-white"},Z={class:"text-3xl font-bold"},ee={class:"text-blue-100 text-sm mt-1"},te={class:"card-modern-gradient from-yellow-500 to-orange-500"},se={class:"flex items-center justify-between text-white"},oe={class:"text-3xl font-bold"},re={class:"text-orange-100 text-sm mt-1"},ne={class:"card-modern-gradient from-purple-500 to-purple-600"},ae={class:"flex items-center justify-between text-white"},le={class:"text-3xl font-bold"},ie={class:"text-purple-100 text-sm mt-1"},de={class:"card-modern"},ce={class:"px-6 py-4 border-b border-gray-200"},ue={class:"flex items-center justify-between"},me={class:"text-sm text-gray-500"},ve={key:0,class:"p-12"},ge={key:1,class:"p-12 text-center"},he={class:"text-gray-500 mb-4"},xe={key:2,class:"overflow-x-auto"},pe={class:"min-w-full divide-y divide-gray-200"},fe={class:"bg-white divide-y divide-gray-200"},_e={class:"table-cell"},ye={class:"text-sm font-medium text-gray-900"},be={key:0,class:"text-xs text-green-600 font-medium"},we={class:"table-cell"},ke={class:"text-sm text-gray-900"},Ce={key:0,class:"text-xs text-gray-500"},Me={class:"table-cell"},je={class:"text-sm text-gray-900"},Ee={key:0,class:"text-sm text-gray-500"},Le={class:"table-cell"},Be={class:"text-sm font-medium text-gray-900"},De={class:"table-cell"},Ae={class:"table-cell"},Te={class:"text-sm text-gray-900"},ze={class:"text-xs text-gray-500"},Re={class:"table-cell text-right"},Se={class:"flex items-center justify-end space-x-2"},Ve=["onClick"],Pe=["onClick"],Fe={key:3,class:"text-center py-12"},Ie={key:0,class:"fixed bottom-4 right-4 max-w-sm w-full bg-white shadow-lg rounded-lg pointer-events-auto ring-1 ring-black ring-opacity-5 overflow-hidden z-50"},$e={class:"p-4"},Ge={class:"flex items-start"},Ne={class:"flex-shrink-0"},He={key:0,class:"h-6 w-6 text-green-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},Ue={key:1,class:"h-6 w-6 text-red-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},We={class:"ml-3 w-0 flex-1 pt-0.5"},Oe={class:"text-sm font-medium text-gray-900"},Qe={class:"ml-4 flex-shrink-0 flex"},qe=z({__name:"conversations",setup(Je){D();const x=A(),p=u(!0),m=u(!1),g=u(null),i=u([]),l=u({active:0,completed:0,inProgress:0,conversionRate:0,newToday:0,completionRate:0,averageWaitTime:0,conversionGrowth:0}),d=u({show:!1,message:"",type:"success"}),_=s=>{if(s.customer_data&&typeof s.customer_data=="object"){const t=s.customer_data;if(t.name)return t.name;if(t.email)return t.email}return s.visitor_id?`Visiteur ${s.visitor_id.slice(0,8)}`:"Visiteur anonyme"},y=s=>{const o=Math.floor((new Date().getTime()-new Date(s).getTime())/(1e3*60));return o<1?"Ã€ l'instant":o<60?`${o}min`:o<1440?`${Math.floor(o/60)}h`:new Date(s).toLocaleDateString("fr-FR")},b=s=>new Date(s).toLocaleDateString("fr-FR",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),w=s=>new Intl.NumberFormat("fr-FR",{style:"currency",currency:"EUR"}).format(s),k=s=>({active:"Active",completed:"TerminÃ©e",abandoned:"AbandonnÃ©e"})[s]||s,C=s=>({active:"bg-green-100 text-green-800",completed:"bg-blue-100 text-blue-800",abandoned:"bg-gray-100 text-gray-800"})[s]||"bg-gray-100 text-gray-800",c=(s,t="success")=>{d.value={show:!0,message:s,type:t},setTimeout(()=>{d.value.show=!1},5e3)},h=async()=>{p.value=!0,g.value=null;try{console.log("ðŸ”„ Chargement conversations via API...");const s=await x.conversations.list();if(s.success&&s.data)i.value=s.data,console.log("âœ… Conversations chargÃ©es:",i.value.length),await M();else throw new Error(s.error||"Erreur lors du chargement des conversations")}catch(s){console.error("âŒ Erreur chargement conversations:",s),g.value=s.message||"Erreur lors du chargement des conversations"}finally{p.value=!1}},M=async()=>{try{const s=i.value,t=new Date().toDateString();l.value={active:s.filter(o=>o.status==="active").length,completed:s.filter(o=>o.status==="completed").length,inProgress:s.filter(o=>o.status==="active").length,newToday:s.filter(o=>new Date(o.started_at).toDateString()===t).length,conversionRate:s.length>0?Math.round(s.filter(o=>o.conversion_completed).length/s.length*100):0,completionRate:s.length>0?Math.round(s.filter(o=>o.status==="completed").length/s.length*100):0,averageWaitTime:3,conversionGrowth:12}}catch(s){console.warn("âš ï¸ Erreur chargement stats:",s)}},j=async()=>{m.value=!0;try{await h(),c("Conversations actualisÃ©es")}finally{m.value=!1}},E=async s=>{try{const t=await x.conversations.get(s.id);t.success?console.log("Conversation dÃ©taillÃ©e:",t.data):c("Erreur lors du chargement des dÃ©tails","error")}catch(t){console.error("Erreur vue conversation:",t),c("Erreur lors du chargement des dÃ©tails","error")}},L=async s=>{try{(await x.conversations.takeover(s.id)).success?(c("Conversation prise en charge avec succÃ¨s"),await h()):c("Erreur lors de la prise en charge","error")}catch(t){console.error("Erreur takeover conversation:",t),c("Erreur lors de la prise en charge","error")}};return R(()=>{h()}),T({title:"Conversations - ChatSeller Dashboard"}),(s,t)=>(a(),n("div",I,[e("div",$,[e("div",G,[e("div",N,[t[3]||(t[3]=e("div",null,[e("h1",{class:"text-3xl font-bold text-gray-900"},"Conversations"),e("p",{class:"mt-2 text-gray-600"}," GÃ©rez toutes vos conversations en temps rÃ©el ")],-1)),e("div",H,[t[2]||(t[2]=e("div",{class:"flex items-center space-x-2 px-3 py-2 bg-green-50 border border-green-200 rounded-lg"},[e("div",{class:"w-2 h-2 bg-green-500 rounded-full animate-pulse"}),e("span",{class:"text-sm font-medium text-green-700"},"En direct")],-1)),e("button",{onClick:j,disabled:m.value,class:"inline-flex items-center px-4 py-2 border border-gray-300 rounded-lg text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50 transition-colors"},[(a(),n("svg",{class:f(["w-4 h-4 mr-2",{"animate-spin":m.value}]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},t[1]||(t[1]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"},null,-1)]),2)),S(" "+r(m.value?"Actualisation...":"Actualiser"),1)],8,U)])])])]),e("div",W,[e("div",O,[e("div",Q,[e("div",q,[e("div",null,[t[4]||(t[4]=e("p",{class:"text-green-100 text-sm font-medium"},"Actives",-1)),e("p",J,r(l.value.active),1),e("p",K," +"+r(l.value.newToday)+" aujourd'hui ",1)]),t[5]||(t[5]=e("div",{class:"p-3 bg-white bg-opacity-20 rounded-xl"},[e("svg",{class:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})])],-1))])]),e("div",X,[e("div",Y,[e("div",null,[t[6]||(t[6]=e("p",{class:"text-blue-100 text-sm font-medium"},"TerminÃ©es",-1)),e("p",Z,r(l.value.completed),1),e("p",ee,r(l.value.completionRate)+"% rÃ©solution ",1)]),t[7]||(t[7]=e("div",{class:"p-3 bg-white bg-opacity-20 rounded-xl"},[e("svg",{class:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})])],-1))])]),e("div",te,[e("div",se,[e("div",null,[t[8]||(t[8]=e("p",{class:"text-orange-100 text-sm font-medium"},"En cours",-1)),e("p",oe,r(l.value.inProgress),1),e("p",re,r(l.value.averageWaitTime)+"min moyenne ",1)]),t[9]||(t[9]=e("div",{class:"p-3 bg-white bg-opacity-20 rounded-xl"},[e("svg",{class:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})])],-1))])]),e("div",ne,[e("div",ae,[e("div",null,[t[10]||(t[10]=e("p",{class:"text-purple-100 text-sm font-medium"},"Conversion",-1)),e("p",le,r(l.value.conversionRate)+"%",1),e("p",ie," +"+r(l.value.conversionGrowth)+"% ce mois ",1)]),t[11]||(t[11]=e("div",{class:"p-3 bg-white bg-opacity-20 rounded-xl"},[e("svg",{class:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"})])],-1))])])]),e("div",de,[e("div",ce,[e("div",ue,[t[12]||(t[12]=e("h3",{class:"text-lg font-semibold text-gray-900"}," Conversations rÃ©centes ",-1)),e("span",me,r(i.value.length)+" conversation(s) ",1)])]),p.value?(a(),n("div",ve,t[13]||(t[13]=[e("div",{class:"flex items-center justify-center"},[e("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),e("span",{class:"ml-3 text-gray-600"},"Chargement des conversations...")],-1)]))):g.value?(a(),n("div",ge,[t[14]||(t[14]=e("div",{class:"text-red-600 mb-4"},[e("svg",{class:"mx-auto h-12 w-12",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.732-.833-2.5 0L4.232 15.5c-.77.833.192 2.5 1.732 2.5z"})])],-1)),t[15]||(t[15]=e("h3",{class:"text-lg font-medium text-gray-900 mb-2"},"Erreur de chargement",-1)),e("p",he,r(g.value),1),e("button",{onClick:h,class:"btn-primary"}," RÃ©essayer ")])):i.value.length>0?(a(),n("div",xe,[e("table",pe,[t[18]||(t[18]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"table-header"},"Conversation"),e("th",{class:"table-header"},"Visiteur"),e("th",{class:"table-header"},"Produit"),e("th",{class:"table-header"},"Messages"),e("th",{class:"table-header"},"Statut"),e("th",{class:"table-header"},"Date"),e("th",{class:"table-header text-right"},"Actions")])],-1)),e("tbody",fe,[(a(!0),n(V,null,P(i.value,o=>(a(),n("tr",{key:o.id,class:"hover:bg-gray-50 transition-colors"},[e("td",_e,[e("div",ye," #"+r(o.id.slice(-8).toUpperCase()),1),o.conversion_completed?(a(),n("div",be," âœ“ Convertie ")):v("",!0)]),e("td",we,[e("div",ke,r(_(o)),1),o.visitor_ip?(a(),n("div",Ce,r(o.visitor_ip),1)):v("",!0)]),e("td",Me,[e("div",je,r(o.product_name||"Aucun produit"),1),o.product_price?(a(),n("div",Ee,r(w(o.product_price)),1)):v("",!0)]),e("td",Le,[e("div",Be,r(o.message_count||0),1),t[16]||(t[16]=e("div",{class:"text-xs text-gray-500"}," messages ",-1))]),e("td",De,[e("span",{class:f([C(o.status),"status-badge"])},r(k(o.status)),3)]),e("td",Ae,[e("div",Te,r(b(o.started_at)),1),e("div",ze,r(y(o.last_activity)),1)]),e("td",Re,[e("div",Se,[e("button",{onClick:B=>E(o),class:"action-button-primary",title:"Voir les dÃ©tails"}," Voir ",8,Ve),o.status==="active"?(a(),n("button",{key:0,onClick:B=>L(o),class:"action-button-secondary",title:"Prendre en charge"},t[17]||(t[17]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})],-1)]),8,Pe)):v("",!0)])])]))),128))])])])):(a(),n("div",Fe,t[19]||(t[19]=[e("svg",{class:"mx-auto h-12 w-12 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})],-1),e("h3",{class:"mt-4 text-lg font-medium text-gray-900"},"Aucune conversation",-1),e("p",{class:"mt-2 text-gray-500"}," Les nouvelles conversations apparaÃ®tront ici ",-1)])))])]),d.value.show?(a(),n("div",Ie,[e("div",$e,[e("div",Ge,[e("div",Ne,[d.value.type==="success"?(a(),n("svg",He,t[20]||(t[20]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"},null,-1)]))):(a(),n("svg",Ue,t[21]||(t[21]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.732-.833-2.5 0L4.232 15.5c-.77.833.192 2.5 1.732 2.5z"},null,-1)])))]),e("div",We,[e("p",Oe,r(d.value.message),1)]),e("div",Qe,[e("button",{onClick:t[0]||(t[0]=o=>d.value.show=!1),class:"bg-white rounded-md inline-flex text-gray-400 hover:text-gray-500"},t[22]||(t[22]=[e("svg",{class:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{"fill-rule":"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z","clip-rule":"evenodd"})],-1)]))])])])])):v("",!0)]))}}),et=F(qe,[["__scopeId","data-v-93503fc4"]]);export{et as default};
