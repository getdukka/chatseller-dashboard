import{a as U,e as P,d as R}from"./Cm96zG12.js";import{u as H}from"./B17ar2pt.js";import{d as m,m as y,I as N,E as u,H as e,M as v,Q as f,u as o,U as l,F as _,P as A,a0 as x,G as r}from"./DQgDrh1u.js";import"./DAvq3nrc.js";import"./CKiNWUy9.js";import"./DwlbBAgr.js";import"./CtDVyml8.js";const q={class:"min-h-screen bg-gray-50 py-8"},j={class:"max-w-4xl mx-auto px-4"},z={class:"bg-white rounded-lg shadow-sm p-6"},L={class:"mb-8"},V={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},O={class:"bg-blue-50 p-4 rounded-lg"},Q={class:"bg-green-50 p-4 rounded-lg"},F={class:"bg-purple-50 p-4 rounded-lg"},G={class:"mb-8"},J={class:"space-y-4"},K=["disabled"],M=["disabled"],W=["disabled"],X={key:0,class:"mt-4"},Y={class:"space-y-2"},Z={class:"font-medium"},ss={class:"text-sm text-gray-600"},es={key:0,class:"text-xs text-gray-500 mt-1"},ts={class:"mb-8"},as={class:"space-y-4"},os=["disabled"],is=["disabled"],ls={key:0,class:"mt-4"},ns={class:"space-y-2"},us={class:"font-medium"},rs={class:"text-sm text-gray-600"},ds={key:0,class:"text-xs text-gray-500 mt-1"},cs={class:"mb-8"},ps={class:"bg-gray-50 p-4 rounded"},gs={class:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm"},bs={key:0},ms={class:"bg-yellow-50 border border-yellow-200 rounded p-4"},hs={class:"space-y-2"},vs={class:"text-sm"},Cs={__name:"diagnostic",setup(fs){const c=R(),p=U(),k=P(),D=H(),i=m({apiHealth:!1,apiAuth:!1,billing:!1,supabase:!1,database:!1}),n=m([]),d=m([]),g=m([]),S=y(()=>p.isAuthenticated?{text:"‚úÖ Connect√©",color:"text-green-600"}:{text:"‚ùå Non connect√©",color:"text-red-600"}),h=m({text:"‚è≥ Non test√©",color:"text-gray-600"}),b=m({text:"‚è≥ Non test√©",color:"text-gray-600"}),C=y(()=>p.user?.email||"Non connect√©"),w=y(()=>p.userShopId||"Non d√©fini");async function T(){i.value.apiHealth=!0;try{const t=await fetch(`${c.public.apiBaseUrl}/health`),s=await t.json();t.ok?(h.value={text:"‚úÖ API OK",color:"text-green-600"},n.value.push({test:"Health Check",success:!0,message:"API accessible et fonctionnelle",data:s})):(h.value={text:"‚ùå API Error",color:"text-red-600"},n.value.push({test:"Health Check",success:!1,message:`Erreur ${t.status}: ${t.statusText}`,data:s}))}catch(t){h.value={text:"‚ùå API Inaccessible",color:"text-red-600"},n.value.push({test:"Health Check",success:!1,message:`Erreur de connexion: ${t.message}`,data:null}),g.value.push("V√©rifiez que l'API est en ligne et que l'URL est correcte")}i.value.apiHealth=!1}async function B(){i.value.apiAuth=!0;try{const t=p.token;if(!t){n.value.push({test:"Test Authentification",success:!1,message:"Aucun token d'authentification disponible",data:null}),g.value.push("Connectez-vous d'abord pour obtenir un token"),i.value.apiAuth=!1;return}const s=await fetch(`${c.public.apiBaseUrl}/api/v1/agents`,{headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}}),a=await s.json();s.ok?n.value.push({test:"Test Authentification",success:!0,message:"Authentification API r√©ussie",data:{agentsCount:a.data?.length||0}}):(n.value.push({test:"Test Authentification",success:!1,message:`Erreur ${s.status}: ${a.error||s.statusText}`,data:a}),s.status===401&&g.value.push("Token d'authentification invalide ou expir√©"))}catch(t){n.value.push({test:"Test Authentification",success:!1,message:`Erreur: ${t.message}`,data:null})}i.value.apiAuth=!1}async function I(){i.value.billing=!0;try{const t=await fetch(`${c.public.apiBaseUrl}/api/v1/billing/diagnostic`),s=await t.json();t.ok&&s.success?n.value.push({test:"Diagnostic Billing",success:!0,message:"Diagnostic syst√®me r√©ussi",data:{prisma:s.diagnostic.prisma.success?"‚úÖ":"‚ùå",supabase:s.diagnostic.supabase.success?"‚úÖ":"‚ùå",stripe:s.diagnostic.stripe.success?"‚úÖ":"‚ùå"}}):n.value.push({test:"Diagnostic Billing",success:!1,message:"Diagnostic syst√®me √©chou√©",data:s})}catch(t){n.value.push({test:"Diagnostic Billing",success:!1,message:`Erreur: ${t.message}`,data:null})}i.value.billing=!1}async function $(){i.value.supabase=!0;try{const{data:t}=await k.auth.getUser();if(!t.user){d.value.push({test:"Supabase Auth",success:!1,message:"Utilisateur non authentifi√© dans Supabase",data:null}),b.value={text:"‚ùå Auth Error",color:"text-red-600"},i.value.supabase=!1;return}const{data:s,error:a}=await k.from("shops").select("id, name").eq("id",t.user.id).limit(1);a?(d.value.push({test:"Supabase Query",success:!1,message:`Erreur requ√™te: ${a.message}`,data:a}),b.value={text:"‚ùå DB Error",color:"text-red-600"},a.code==="42501"&&g.value.push("Probl√®me de permissions RLS. V√©rifiez les politiques Supabase.")):(d.value.push({test:"Supabase Query",success:!0,message:"Requ√™te Supabase r√©ussie",data:s}),b.value={text:"‚úÖ DB OK",color:"text-green-600"})}catch(t){d.value.push({test:"Supabase Direct",success:!1,message:`Erreur: ${t.message}`,data:null}),b.value={text:"‚ùå DB Error",color:"text-red-600"}}i.value.supabase=!1}async function E(){i.value.database=!0;try{const t=await D.analytics.getStats();t.success?d.value.push({test:"useDatabase Analytics",success:!0,message:"Composable useDatabase fonctionne",data:t.data}):d.value.push({test:"useDatabase Analytics",success:!1,message:`Erreur composable: ${t.error}`,data:null});const s=await D.conversations.list();s.success?d.value.push({test:"useDatabase Conversations",success:!0,message:`${s.data?.length||0} conversations trouv√©es`,data:{count:s.data?.length||0}}):d.value.push({test:"useDatabase Conversations",success:!1,message:`Erreur conversations: ${s.error}`,data:null})}catch(t){d.value.push({test:"useDatabase Composable",success:!1,message:`Erreur: ${t.message}`,data:null})}i.value.database=!1}return N(()=>{console.log("üîß Configuration actuelle:",{apiUrl:c.public.apiBaseUrl,supabaseUrl:c.public.supabaseUrl,user:p.user,shopId:p.userShopId})}),(t,s)=>(r(),u("div",q,[e("div",j,[e("div",z,[s[15]||(s[15]=e("h1",{class:"text-2xl font-bold text-gray-900 mb-6"}," üîß Diagnostic ChatSeller ",-1)),e("div",L,[s[3]||(s[3]=e("h2",{class:"text-lg font-semibold mb-4"},"üìä Status G√©n√©ral",-1)),e("div",V,[e("div",O,[s[0]||(s[0]=e("div",{class:"text-sm text-blue-600"},"Authentification",-1)),e("div",{class:f(["text-lg font-semibold",o(S).color])},l(o(S).text),3)]),e("div",Q,[s[1]||(s[1]=e("div",{class:"text-sm text-green-600"},"API Backend",-1)),e("div",{class:f(["text-lg font-semibold",o(h).color])},l(o(h).text),3)]),e("div",F,[s[2]||(s[2]=e("div",{class:"text-sm text-purple-600"},"Base de Donn√©es",-1)),e("div",{class:f(["text-lg font-semibold",o(b).color])},l(o(b).text),3)])])]),e("div",G,[s[5]||(s[5]=e("h2",{class:"text-lg font-semibold mb-4"},"üß™ Tests API",-1)),e("div",J,[e("button",{onClick:T,disabled:o(i).apiHealth,class:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 disabled:opacity-50"},l(o(i).apiHealth?"Test en cours...":"Tester Health Check"),9,K),e("button",{onClick:B,disabled:o(i).apiAuth,class:"bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 disabled:opacity-50 ml-2"},l(o(i).apiAuth?"Test en cours...":"Tester Authentification"),9,M),e("button",{onClick:I,disabled:o(i).billing,class:"bg-purple-600 text-white px-4 py-2 rounded hover:bg-purple-700 disabled:opacity-50 ml-2"},l(o(i).billing?"Test en cours...":"Tester Diagnostic Billing"),9,W)]),o(n).length>0?(r(),u("div",X,[s[4]||(s[4]=e("h3",{class:"font-semibold mb-2"},"R√©sultats :",-1)),e("div",Y,[(r(!0),u(_,null,A(o(n),a=>(r(),u("div",{key:a.test,class:f(["p-3 rounded border-l-4",a.success?"bg-green-50 border-green-400":"bg-red-50 border-red-400"])},[e("div",Z,l(a.test),1),e("div",ss,l(a.message),1),a.data?(r(),u("div",es,[e("pre",null,l(JSON.stringify(a.data,null,2)),1)])):v("",!0)],2))),128))])])):v("",!0)]),e("div",ts,[s[7]||(s[7]=e("h2",{class:"text-lg font-semibold mb-4"},"üóÑÔ∏è Tests Base de Donn√©es",-1)),e("div",as,[e("button",{onClick:$,disabled:o(i).supabase,class:"bg-indigo-600 text-white px-4 py-2 rounded hover:bg-indigo-700 disabled:opacity-50"},l(o(i).supabase?"Test en cours...":"Tester Supabase Direct"),9,os),e("button",{onClick:E,disabled:o(i).database,class:"bg-teal-600 text-white px-4 py-2 rounded hover:bg-teal-700 disabled:opacity-50 ml-2"},l(o(i).database?"Test en cours...":"Tester useDatabase"),9,is)]),o(d).length>0?(r(),u("div",ls,[s[6]||(s[6]=e("h3",{class:"font-semibold mb-2"},"R√©sultats :",-1)),e("div",ns,[(r(!0),u(_,null,A(o(d),a=>(r(),u("div",{key:a.test,class:f(["p-3 rounded border-l-4",a.success?"bg-green-50 border-green-400":"bg-red-50 border-red-400"])},[e("div",us,l(a.test),1),e("div",rs,l(a.message),1),a.data?(r(),u("div",ds," Donn√©es : "+l(typeof a.data=="object"?JSON.stringify(a.data).substring(0,100)+"...":a.data),1)):v("",!0)],2))),128))])])):v("",!0)]),e("div",cs,[s[12]||(s[12]=e("h2",{class:"text-lg font-semibold mb-4"},"‚öôÔ∏è Configuration",-1)),e("div",ps,[e("div",gs,[e("div",null,[s[8]||(s[8]=e("strong",null,"API URL:",-1)),x(" "+l(o(c).apiUrl),1)]),e("div",null,[s[9]||(s[9]=e("strong",null,"Supabase URL:",-1)),x(" "+l(o(c).supabaseUrl),1)]),e("div",null,[s[10]||(s[10]=e("strong",null,"Utilisateur:",-1)),x(" "+l(o(C)),1)]),e("div",null,[s[11]||(s[11]=e("strong",null,"Shop ID:",-1)),x(" "+l(o(w)),1)])])])]),o(g).length>0?(r(),u("div",bs,[s[14]||(s[14]=e("h2",{class:"text-lg font-semibold mb-4"},"üí° Recommandations",-1)),e("div",ms,[e("ul",hs,[(r(!0),u(_,null,A(o(g),a=>(r(),u("li",{key:a,class:"flex items-start"},[s[13]||(s[13]=e("span",{class:"text-yellow-600 mr-2"},"‚ö†Ô∏è",-1)),e("span",vs,l(a),1)]))),128))])])])):v("",!0)])])]))}};export{Cs as default};
