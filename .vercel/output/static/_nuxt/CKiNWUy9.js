import{B as o,m as t}from"./DQgDrh1u.js";import{a as n,b as i}from"./Cm96zG12.js";import"./DAvq3nrc.js";const l=o("analytics",{state:()=>({data:null,isLoading:!1,error:null,lastFetch:null,selectedPeriod:"30d"}),getters:{totalConversations:e=>e.data?.totalConversations||0,activeConversations:e=>e.data?.activeConversations||0,completedOrders:e=>e.data?.completedOrders||0,conversionRate:e=>e.data?.conversionRate||0,totalRevenue:e=>e.data?.totalRevenue||0,averageOrderValue:e=>e.data?.averageOrderValue||0,formattedRevenue:e=>{const r=e.data?.totalRevenue||0;return new Intl.NumberFormat("fr-FR",{style:"currency",currency:"EUR"}).format(r)},formattedAOV:e=>{const r=e.data?.averageOrderValue||0;return new Intl.NumberFormat("fr-FR",{style:"currency",currency:"EUR"}).format(r)},formattedConversionRate:e=>`${((e.data?.conversionRate||0)*100).toFixed(1)}%`,needsRefresh:e=>{if(!e.lastFetch)return!0;const r=new Date(Date.now()-300*1e3);return e.lastFetch<r}},actions:{async fetchAnalytics(e=!1){if(!e&&!this.needsRefresh)return;if(!n().isAuthenticated){this.error="Utilisateur non authentifié";return}this.isLoading=!0,this.error=null;try{console.log("📊 [Analytics] Chargement analytics via API...");const a=await i().analytics.dashboard();console.log("📊 [Analytics] Réponse API:",a),a.success&&a.data?(this.data=a.data,this.lastFetch=new Date,this.error=null,console.log("✅ [Analytics] Analytics chargées avec succès")):(this.error=a.error||"Erreur lors du chargement des analytics",console.error("❌ [Analytics] Erreur:",this.error))}catch(s){this.error=s.message||"Erreur lors du chargement des analytics",console.error("❌ [Analytics] Exception:",s)}finally{this.isLoading=!1}},setPeriod(e){this.selectedPeriod!==e&&(this.selectedPeriod=e,this.fetchAnalytics(!0))},clearError(){this.error=null},clearData(){this.data=null,this.error=null,this.lastFetch=null,this.selectedPeriod="30d"},getPeriodLabel(){switch(this.selectedPeriod){case"7d":return"7 derniers jours";case"30d":return"30 derniers jours";case"90d":return"3 derniers mois";case"1y":return"12 derniers mois";default:return"30 derniers jours"}}}}),h=()=>{const e=l();return{data:t(()=>e.data),isLoading:t(()=>e.isLoading),error:t(()=>e.error),selectedPeriod:t(()=>e.selectedPeriod),totalConversations:t(()=>e.totalConversations),activeConversations:t(()=>e.activeConversations),completedOrders:t(()=>e.completedOrders),conversionRate:t(()=>e.conversionRate),totalRevenue:t(()=>e.totalRevenue),averageOrderValue:t(()=>e.averageOrderValue),formattedRevenue:t(()=>e.formattedRevenue),formattedAOV:t(()=>e.formattedAOV),formattedConversionRate:t(()=>e.formattedConversionRate),fetchAnalytics:e.fetchAnalytics,setPeriod:e.setPeriod,clearError:e.clearError,clearData:e.clearData,getPeriodLabel:e.getPeriodLabel}};export{h as useAnalytics,l as useAnalyticsStore};
