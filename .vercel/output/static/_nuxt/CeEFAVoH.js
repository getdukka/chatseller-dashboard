import{B as o,m as a}from"./Dp9Ai0YM.js";import{b as l,a as i}from"./BIGBsnYa.js";import"./bq2zsT37.js";const d=o("orders",{state:()=>({orders:[],currentOrder:null,isLoading:!1,isCreating:!1,error:null,lastFetch:null,filters:{status:"all",dateRange:{start:null,end:null},searchTerm:""}}),getters:{filteredOrders:e=>{let r=[...e.orders];if(e.filters.status!=="all"&&(r=r.filter(t=>t.status===e.filters.status)),e.filters.dateRange.start&&(r=r.filter(t=>new Date(t.createdAt)>=e.filters.dateRange.start)),e.filters.dateRange.end&&(r=r.filter(t=>new Date(t.createdAt)<=e.filters.dateRange.end)),e.filters.searchTerm){const t=e.filters.searchTerm.toLowerCase();r=r.filter(s=>s.customerName.toLowerCase().includes(t)||s.customerPhone.toLowerCase().includes(t)||s.customerEmail&&s.customerEmail.toLowerCase().includes(t)||s.productItems.some(n=>n.name.toLowerCase().includes(t)))}return r.sort((t,s)=>new Date(s.createdAt).getTime()-new Date(t.createdAt).getTime())},pendingOrders:e=>e.orders.filter(r=>r.status==="pending"),confirmedOrders:e=>e.orders.filter(r=>r.status==="confirmed"),cancelledOrders:e=>e.orders.filter(r=>r.status==="cancelled"),totalOrders:e=>e.orders.length,totalRevenue:e=>e.orders.filter(r=>r.status==="confirmed").reduce((r,t)=>r+t.totalAmount,0),averageOrderValue:e=>{const r=e.orders.filter(t=>t.status==="confirmed");return r.length===0?0:r.reduce((t,s)=>t+s.totalAmount,0)/r.length},getOrderById:e=>r=>e.orders.find(t=>t.id===r),needsRefresh:e=>{if(!e.lastFetch)return!0;const r=new Date(Date.now()-600*1e3);return e.lastFetch<r}},actions:{async fetchOrders(e=!1){if(!e&&!this.needsRefresh)return;if(!i().isAuthenticated){this.error="Utilisateur non authentifié";return}this.isLoading=!0,this.error=null;try{console.log("🛒 [Orders] Chargement commandes via API...");const s=await l().orders.list();console.log("🛒 [Orders] Réponse API:",s),s.success&&s.data?(this.orders=s.data,this.lastFetch=new Date,this.error=null,console.log("✅ [Orders] Commandes chargées:",s.data.length)):(this.orders=[],this.lastFetch=new Date,this.error=null,console.log("ℹ️ [Orders] Pas de commandes (API pas encore implémentée)"))}catch(t){this.error=t.message||"Erreur lors du chargement des commandes",console.error("❌ [Orders] Exception:",t),this.orders=[],this.lastFetch=new Date}finally{this.isLoading=!1}},async startOrder(e){try{console.log("🛒 [Orders] Démarrage workflow commande...");const t=await l().orders.startOrder(e);return t.success?(console.log("✅ [Orders] Workflow commande démarré"),t.data):(this.error=t.error||"Erreur lors du démarrage de la commande",null)}catch(r){return this.error=r.message||"Erreur lors du démarrage de la commande",console.error("❌ [Orders] Exception:",r),null}},async completeOrder(e){this.isCreating=!0;try{console.log("🛒 [Orders] Finalisation commande...");const t=await l().orders.complete(e);return t.success&&t.data?(this.orders.unshift(t.data),console.log("✅ [Orders] Commande finalisée"),t.data):(this.error=t.error||"Erreur lors de la finalisation de la commande",null)}catch(r){return this.error=r.message||"Erreur lors de la finalisation de la commande",console.error("❌ [Orders] Exception:",r),null}finally{this.isCreating=!1}},setStatusFilter(e){this.filters.status=e},setDateRangeFilter(e,r){this.filters.dateRange.start=e,this.filters.dateRange.end=r},setSearchTerm(e){this.filters.searchTerm=e},clearFilters(){this.filters={status:"all",dateRange:{start:null,end:null},searchTerm:""}},setCurrentOrder(e){this.currentOrder=e},clearError(){this.error=null},clearData(){this.orders=[],this.currentOrder=null,this.error=null,this.lastFetch=null,this.clearFilters()}}}),h=()=>{const e=d();return{orders:a(()=>e.orders),currentOrder:a(()=>e.currentOrder),isLoading:a(()=>e.isLoading),isCreating:a(()=>e.isCreating),error:a(()=>e.error),filters:a(()=>e.filters),filteredOrders:a(()=>e.filteredOrders),pendingOrders:a(()=>e.pendingOrders),confirmedOrders:a(()=>e.confirmedOrders),cancelledOrders:a(()=>e.cancelledOrders),totalOrders:a(()=>e.totalOrders),totalRevenue:a(()=>e.totalRevenue),averageOrderValue:a(()=>e.averageOrderValue),fetchOrders:e.fetchOrders,startOrder:e.startOrder,completeOrder:e.completeOrder,setStatusFilter:e.setStatusFilter,setDateRangeFilter:e.setDateRangeFilter,setSearchTerm:e.setSearchTerm,clearFilters:e.clearFilters,setCurrentOrder:e.setCurrentOrder,clearError:e.clearError,clearData:e.clearData,getOrderById:e.getOrderById}};export{h as useOrders,d as useOrdersStore};
